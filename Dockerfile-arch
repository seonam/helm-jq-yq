FROM alpine:3.21

ARG TARGETPLATFORM
ARG HELM_VERSION=3.18.6

RUN echo "$TARGETPLATFORM"

RUN apk add --no-cache curl jq yq bash ca-certificates && \
    ARCH=amd64 && \
    case "$TARGETPLATFORM" in \
      "linux/amd64") ARCH=amd64 ;; \
      "linux/arm64") ARCH=arm64 ;; \
      *) echo "Unsupported architecture: $TARGETPLATFORM"; exit 1 ;; \
    esac && \
    curl -fsSL "https://get.helm.sh/helm-v${HELM_VERSION}-linux-${ARCH}.tar.gz" | \
    tar -xz --strip-components=1 -C /usr/local/bin linux-${ARCH}/helm && \
    chmod +x /usr/local/bin/helm

WORKDIR /app

CMD ["bash"]

